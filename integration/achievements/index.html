<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>モーダル型実績ビュー</title>
    <link rel="stylesheet" href="../styles.css">
</head>

<body class="dashboard-body mode-fullscreen allow-scroll">
    <!-- ハンバーガーメニュー -->
    <button id="nav-toggle" class="site-nav-toggle" aria-label="メニューを開く" aria-expanded="false">
        <span class="hamburger" aria-hidden="true"></span>
    </button>

    <nav id="nav-drawer" class="nav-drawer" aria-hidden="true" aria-label="サイトナビゲーション">
        <h2>ナビゲーション</h2>
        <ul>
            <li><a href="../index.html">統合トップ</a></li>
            <li><a href="../catalog/index.html">カタログ</a></li>
            <li><a href="../ats/index.html">ATS</a></li>
            <li><a href="../achievements/index.html">実績</a></li>
            <li><a href="../nonconformity_information/index.html">不適合情報</a></li>
            <li><a href="../physical_properties/index.html">物性</a></li>
        </ul>
    </nav>
    <div id="nav-overlay" class="nav-overlay" tabindex="-1" aria-hidden="true"></div>
    <main class="shell shell--fullscreen dashboard-shell">
        <header class="masthead masthead--compact">
            <h1>モーダル型実績ビュー</h1>
        </header>

        <!-- 表示列選択は期間フィルタ内に移動しました -->

        <div class="dashboard-filters">
            <div class="filter-group">
                <label for="ach-date-from" class="filter-label">開始日</label>
                <input id="ach-date-from" type="date" class="filter-input" value="2024-01-01" data-jshook="date-from">
            </div>
            <div class="filter-group">
                <label for="ach-date-to" class="filter-label">終了日</label>
                <input id="ach-date-to" type="date" class="filter-input" value="2025-12-31" data-jshook="date-to">
            </div>
            <!-- カテゴリ検索は不要のため削除 -->
            <button type="button" class="filter-button" data-jshook="search-button">検索</button>

            <div class="column-controls">
                <button type="button" id="column-dropdown-button" class="column-controls-button">表示列を選択</button>
                <div id="column-dropdown-panel" class="column-dropdown-panel" aria-hidden="true">
                    <div class="column-dropdown-actions">
                        <button type="button" id="col-select-all" class="small-button">すべて選択</button>
                        <button type="button" id="col-select-none" class="small-button">すべて解除</button>
                    </div>
                    <div id="column-options" class="column-options">
                        <!-- CSVヘッダに応じてここにチェックボックスが動的生成されます -->
                    </div>
                </div>
            </div>
        </div>

        <section class="dashboard-section" aria-label="実績詳細テーブル">
            <header class="dashboard-section__header">
                <h2 class="dashboard-section__title">実績詳細テーブル</h2>
                <button type="button" class="control-button" data-jshook="export-button">
                    <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
                        <path
                            fill="currentColor"
                            d="M12 3a1 1 0 0 1 1 1v8.59l2.3-2.3a1 1 0 1 1 1.4 1.42l-4 4a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.42L11 12.59V4a1 1 0 0 1 1-1zM5 19a1 1 0 0 1 0-2h14a1 1 0 1 1 0 2H5z"
                        ></path>
                    </svg>
                    エクスポート
                </button>
            </header>
            <div class="table-frame">
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>日付</th>
                                <th>カテゴリ</th>
                                <th>項目名</th>
                                <th>実績値</th>
                                <th>単位</th>
                                <th>状態</th>
                                <th>備考</th>
                            </tr>
                        </thead>
                        <tbody data-jshook="table-body"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <button type="button" class="floating-ai-button" id="modal-open">AI</button>

    <div class="ai-modal-overlay" id="modal-window">
        <div class="ai-modal-window">
            <div class="ai-assistant-container">
                <div class="ai-assistant-header">
                    <h3>AIアシスタント</h3>
                    <button type="button" id="modal-close" class="ai-modal-close">×</button>
                </div>
                <div class="ai-capabilities">
                    <h4>回答可能な情報</h4>
                    <div class="capability-grid">
                        <div class="capability-item">
                            <div class="capability-icon">📈</div>
                            <div class="capability-text"><strong>トレンド分析</strong><span>時系列変化、異常検知</span></div>
                        </div>
                        <div class="capability-item">
                            <div class="capability-icon">⚠️</div>
                            <div class="capability-text"><strong>アラート情報</strong><span>異常状態、注意項目</span></div>
                        </div>
                    </div>
                </div>
                <div class="ai-chat-section ai-chat-section--plain">
                    <div class="ai-messages" data-jshook="chat-display"></div>
                    <div class="ai-input-container">
                        <div class="ai-input-wrapper">
                            <input type="text" class="ai-input" placeholder="AIに確認したいことを入力..." data-jshook="chat-input">
                            <button type="button" class="ai-send-button" data-jshook="chat-send">送信</button>
                        </div>
                    </div>
                </div>
                <div data-jshook="suggestion-buttons" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="script.js"></script>
    <script src="../navigation.js"></script>
    <script>
        // 列表示切替のロジック
        document.addEventListener('DOMContentLoaded', () => {
            const toggles = document.querySelectorAll('.col-toggle');
            const table = document.querySelector('.data-table');

            function setColumnVisibility(colIndex, visible) {
                // thead
                const th = table.querySelectorAll('thead th')[colIndex];
                if (th) th.style.display = visible ? '' : 'none';
                // tbody rows
                table.querySelectorAll('tbody tr').forEach(row => {
                    const cell = row.querySelectorAll('td')[colIndex];
                    if (cell) cell.style.display = visible ? '' : 'none';
                });
            }

            toggles.forEach(toggle => {
                const col = parseInt(toggle.dataset.col, 10);
                // initial state already checked by markup, but ensure applied
                setColumnVisibility(col, toggle.checked);
                toggle.addEventListener('change', (e) => {
                    setColumnVisibility(col, e.target.checked);
                });
            });
        });
    </script>
    <script>
        // モーダル表示の制御（script.jsと共存）
        document.addEventListener('DOMContentLoaded', () => {
            const modalWindow = document.getElementById('modal-window');
            const openButton = document.getElementById('modal-open');
            const closeButton = document.getElementById('modal-close');

            if (openButton) {
                openButton.addEventListener('click', () => modalWindow.classList.add('is-active'));
            }
            if (closeButton) {
                closeButton.addEventListener('click', () => modalWindow.classList.remove('is-active'));
            }
            if (modalWindow) {
                modalWindow.addEventListener('click', (event) => {
                    if (event.target === modalWindow) {
                        modalWindow.classList.remove('is-active');
                    }
                });
            }
        });
    </script>
    <script>
        // 埋め込みAIチャット（ハリボテ）の最小動作
        document.addEventListener('DOMContentLoaded', () => {
            const display = document.querySelector('[data-jshook="embedded-chat-display"]');
            const input = document.querySelector('[data-jshook="embedded-chat-input"]');
            const send = document.querySelector('[data-jshook="embedded-chat-send"]');

            function appendMessage(text, cls) {
                const el = document.createElement('div');
                el.className = 'ai-message ' + cls;
                el.textContent = text;
                display.appendChild(el);
                display.scrollTop = display.scrollHeight;
            }

            function userSend() {
                const v = input.value && input.value.trim();
                if (!v) return;
                appendMessage(v, 'ai-message--user');
                input.value = '';
                // 擬似応答（ハリボテ）
                setTimeout(() => {
                    appendMessage('これはデモ応答です: 「' + v + '」については現在データ参照機能がありません。', 'ai-message--bot');
                }, 500);
            }

            if (send) send.addEventListener('click', userSend);
            if (input) input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') userSend();
            });
        });
    </script>
</body>

</html>
